# 我是如何写 Vue 单元测试的

从使用 Vue 写出第一个 `Hello world` 到现在已经有近两年时间了，期间利用业余时间折腾了一套组件 we-vue，起初是出于实践学到的新知识，更多的是玩的意思，不过后来维护的过程中渐渐积累了一些经验，并开始享受这种过程。

在 we-vue 更新到 v2.0 的时候，开始全面地编写单元测试。起先使用 karma + mocha + chrome-headless 这种组合完成的行级覆盖率达到 99% 的单元测试。但最近，经过一番权衡之后，又放弃了这种组合，使用 jest 替代之。在这一系列折腾中，过过不少坑（当然，很多时候是自己挖坑自己跳），也解锁了不少新姿势，这也是本文中要讲的。

## 为什么要写单元测试

作为一个程序员，单元测试或许是一个绕不开的课题。我大致总结了一下当初决定做单元测试的原因如下：

1. 


首先，这里的“我”，只是一个默默无闻写码多年的小码农，所以文中所写的内容，仅仅是个人经验，并算不得什么“最佳实践”。

大概在一年多前，

为什么要写单元测试， 

单元测试的作用

就像当初学数学时那样，做完一个题后，换种做法再算一次进行验算。

## karma + mocha + Chrome(headless 模式)

其实对也可以使用 jest，起初自己也作过这方面的尝试，但由于 vue-jest 等辅助包仍不完善，使得测试时无法加载样式文件等问题而最终放弃，并决定使用 karme + mocha 这黄金搭档来执行测试。

新版本的 Chrome 支持以 headless 模式运行，这对于测试这种不需要显示界面的任务来说是很合适了。

与之相对的，你也可以考虑使用 PhantomJS 来模拟浏览器环境，但它有着不少问题，而且更新进度越来越慢，昨日 2018-03-05 得知，因为开发组内部意见不合，phantomJS 项目已经封存了代码，暂停开发了。

## vue-test-utils

vue-test-utils 也是 Vue 生态圈中的一个开源项目，截至日前（2018-0-21）仍然处于 Beta 阶段，

vue-test-utils 的前身是 avoriaz，出自同一个作者，avariaz 也是一个不错的包，但其 README 中说明的

## WebStorm 或 Visual Studio Code



## 选择一个好的断言库

即使是在一开始使用 karma + mocha 进行测试的时候，我也没有使用 vue-cli 默认模板里配置的 chai，而是自行安装配置了 expect.js (expect 是 jest 的一部分，可以单独安装使用)。主要是出于对 expect 断言函数和语法方面的喜爱，这也为后期迁移到 jest 省了不少事。

当然，chai 也是一个很优化的库，是否选择取决于个人喜好以及项目的实际情况。

## 利用 CI 平台自动进行单元测试、构建以及发布



## 题外话

